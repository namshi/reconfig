(function(global,factory){if(typeof define==="function"&&define.amd){define("Reconfig",["module","exports","lodash/includes","lodash/set","lodash/get","lodash/escapeRegExp","lodash/isObject","lodash/isUndefined","lodash/isNull","lodash/cloneDeep","lodash/merge","lodash/isArray"],factory)}else if(typeof exports!=="undefined"){factory(module,exports,require("lodash/includes"),require("lodash/set"),require("lodash/get"),require("lodash/escapeRegExp"),require("lodash/isObject"),require("lodash/isUndefined"),require("lodash/isNull"),require("lodash/cloneDeep"),require("lodash/merge"),require("lodash/isArray"))}else{var mod={exports:{}};factory(mod,mod.exports,global.includes,global.set,global.get,global.escapeRegExp,global.isObject,global.isUndefined,global.isNull,global.cloneDeep,global.merge,global.isArray);global.Reconfig=mod.exports}})(this,function(module,exports,_includes2,_set2,_get2,_escapeRegExp2,_isObject2,_isUndefined2,_isNull2,_cloneDeep2,_merge2,_isArray2){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _includes3=_interopRequireDefault(_includes2);var _set3=_interopRequireDefault(_set2);var _get3=_interopRequireDefault(_get2);var _escapeRegExp3=_interopRequireDefault(_escapeRegExp2);var _isObject3=_interopRequireDefault(_isObject2);var _isUndefined3=_interopRequireDefault(_isUndefined2);var _isNull3=_interopRequireDefault(_isNull2);var _cloneDeep3=_interopRequireDefault(_cloneDeep2);var _merge3=_interopRequireDefault(_merge2);var _isArray3=_interopRequireDefault(_isArray2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var getConfigFromEnv=function getConfigFromEnv(prefix){var separator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"_";var envConfig={};Object.keys(process.env).forEach(function(key){var value=process.env[key];if((0,_includes3.default)(key,prefix)){var path=key.replace(prefix+separator,"").replace(new RegExp(separator,"g"),".");(0,_set3.default)(envConfig,path,value)}});return envConfig};var Reconfig=function(){function Reconfig(config){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},envPrefix=_ref.envPrefix,separator=_ref.separator,_ref$paramsInterpolat=_ref.paramsInterpolation,paramsInterpolation=_ref$paramsInterpolat===undefined?[":",""]:_ref$paramsInterpolat;_classCallCheck(this,Reconfig);this._config=null;this._rawConfig=null;this._envPrefix=envPrefix;this._separator=separator;this._paramsInterpolation=paramsInterpolation.map(_escapeRegExp3.default);this.set(config)}_createClass(Reconfig,[{key:"resolveReferences",value:function resolveReferences(){var _this=this;var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var reference=null;var references=value.match(/{{\s*[\w\.]+\s*}}/g);if(references&&references.length===1){reference=this.resolve(this.get(references[0].replace(/[^\w.]/g,"")));if(reference===null||(0,_isObject3.default)(reference)){return reference}}return value.replace(/{{\s*[\w\.]+\s*}}/g,function(ref){return _this.resolve(_this.get(ref.replace(/[^\w.]/g,"")))})}},{key:"resolveParameters",value:function resolveParameters(value,parameters){if(!(0,_isObject3.default)(parameters)){return value}for(var property in parameters){if(value){value=value.replace(RegExp(this._paramsInterpolation[0]+property+this._paramsInterpolation[1],"g"),parameters[property]||"")}}return value}},{key:"resolveObject",value:function resolveObject(object,parameters){var _this2=this;var clonedObject=(0,_cloneDeep3.default)(object);Object.keys(clonedObject).forEach(function(key){var value=clonedObject[key];clonedObject[key]=_this2.resolve(value,parameters)});return clonedObject}},{key:"resolve",value:function resolve(value,parameters){if(typeof value==="string"){value=this.resolveReferences(value);if(parameters){value=this.resolveParameters(value,parameters)}}if((0,_isObject3.default)(value)){value=this.resolveObject(value,parameters)}return value}},{key:"set",value:function set(config){if(!config){return}if(this._envPrefix){if(process&&process.env&&typeof process.env!=="string"){(0,_merge3.default)(config,getConfigFromEnv(this._envPrefix,this._separator))}else{console.warn("HEY HEY HEY, this feature is supposed to be used in node only :)")}}this._config=this._rawConfig=(0,_isObject3.default)(this._rawConfig)||(0,_isArray3.default)(this._rawConfig)?(0,_merge3.default)(this._rawConfig,config):config;this._config=this.resolve(this._config)}},{key:"get",value:function get(path,parameters,fallbackValue){if(!path){return this._config}var value=(0,_get3.default)(this._config,path,fallbackValue);value=parameters?this.resolve(value,parameters):value;return(0,_isUndefined3.default)(value)||(0,_isNull3.default)(value)?null:value}}]);return Reconfig}();exports.default=Reconfig;module.exports=exports["default"]});
//# sourceMappingURL=build/reconfig.min.js.map